<%- include('partials/header') %>

    <div class="glass-panel">
        <h1><i class="fas fa-cog"></i> Impostazioni</h1>

        <div style="margin-top: 20px;">
            <h3>Aspetto</h3>
            <div style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                <label>Modalit√† Scura</label>
                <label class="switch">
                    <input type="checkbox" id="theme-toggle" onclick="toggleTheme()">
                    <span class="slider round"></span>
                </label>
            </div>
            <script>
                // Set initial state
                // Default is now dark, so if theme is NOT light, it is dark.
                const currentTheme = document.documentElement.getAttribute('data-theme');
                if (currentTheme === 'dark') {
                    document.getElementById('theme-toggle').checked = true;
                }
            </script>
        </div>

        <div style="margin-top: 40px; border-top: 1px solid var(--glass-border); padding-top: 20px;">
            <h3><i class="fas fa-user-edit"></i> Modifica Profilo</h3>
            <% if (typeof error !=='undefined' && error) { %>
                <div class="alert"
                    style="background: rgba(255, 0, 0, 0.1); color: #ff6b6b; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                    <%= error %>
                </div>
                <% } %>
                    <% if (typeof success !=='undefined' && success) { %>
                        <div class="alert"
                            style="background: rgba(0, 255, 0, 0.1); color: #4ade80; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                            <%= success %>
                        </div>
                        <% } %>

                            <form action="/settings/profile" method="POST" enctype="multipart/form-data"
                                style="max-width: 500px;">
                                <div class="form-group">
                                    <label>Username</label>
                                    <input type="text" name="username" class="form-control" value="<%= user.username %>"
                                        required>
                                </div>
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" name="email" class="form-control" value="<%= user.email %>"
                                        required>
                                </div>
                                <div class="form-group">
                                    <label>Avatar (Carica Nuova Immagine)</label>
                                    <input type="file" name="avatar" class="form-control" accept="image/*">
                                </div>
                                <div class="form-group">
                                    <label>Nuova Password (lascia vuoto per non cambiare)</label>
                                    <input type="password" name="password" class="form-control">
                                </div>
                                <!-- Hidden input for current role to prevent accidental loss if logic changes, though we won't trust it on server -->
                                <button type="submit" class="btn btn-primary">Salva Modifiche</button>
                            </form>
        </div>

        <style>
            /* Switch styles */
            .switch {
                position: relative;
                display: inline-block;
                width: 60px;
                height: 34px;
            }

            .switch input {
                opacity: 0;
                width: 0;
                height: 0;
            }

            .slider {
                position: absolute;
                cursor: pointer;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: #ccc;
                transition: .4s;
                border-radius: 34px;
            }

            .slider:before {
                position: absolute;
                content: "";
                height: 26px;
                width: 26px;
                left: 4px;
                bottom: 4px;
                background-color: white;
                transition: .4s;
                border-radius: 50%;
            }

            input:checked+.slider {
                background-color: var(--primary);
            }

            input:checked+.slider:before {
                transform: translateX(26px);
            }
        </style>
    </div>

    <%- include('partials/footer') %>